<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Simulation d'amortissement - Annuité constante avec assurance</title>
  <link rel="stylesheet" href="theme.css">
  <style>
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 6px 10px; text-align: right; }
    th { background: #f0f0f0; }
    td:first-child, th:first-child { text-align: center; }
  </style>
</head>
<body>
  <header>
    <nav>
      <ul>
        <li><a href="index.html">Accueil</a></li>
        <li><a href="fonds.html">Gestion des fonds</a></li>
        <li><a href="loan_types.html">Gestion des types de prêt</a></li>
        <li><a href="client_loans.html">Gestion des prêts clients</a></li>
        <li><a href="monthly_interests.html">Intérêts mensuels</a></li>
        <li><a href="amortissement.html">Simulation d'amortissement</a></li>
      </ul>
    </nav>
  </header>
  <h1>Simulation de remboursement (annuité constante avec assurance)</h1>
  <form id="amortissement-form">
    <label for="amount">Montant du prêt (€):</label>
    <input type="number" id="amount" required>
    <label for="rate">Taux d'intérêt annuel (%):</label>
    <input type="number" id="rate" step="0.01" required>
    <label for="duration">Durée (mois):</label>
    <input type="number" id="duration" required>
    <label for="insurance">Taux d'assurance (% du capital):</label>
    <input type="number" id="insurance" step="0.01" value="0">
    <button type="submit">Calculer</button>
  </form>
  <div id="result"></div>
  <button onclick="window.location.href='index.html'">Retour à l'accueil</button>
  <script>
    document.getElementById('amortissement-form').addEventListener('submit', function(e) {
      e.preventDefault();
      const amount = parseFloat(document.getElementById('amount').value);
      const rate = parseFloat(document.getElementById('rate').value) / 100 / 12;
      const duration = parseInt(document.getElementById('duration').value);
      const insuranceRate = parseFloat(document.getElementById('insurance').value) / 100;
      if (isNaN(amount) || isNaN(rate) || isNaN(duration) || isNaN(insuranceRate) || amount <= 0 || rate < 0 || duration <= 0 || insuranceRate < 0) {
        document.getElementById('result').innerHTML = "<p style='color:red'>Veuillez saisir des valeurs valides.</p>";
        return;
      }
      const annuite = rate === 0 ? amount / duration : amount * rate / (1 - Math.pow(1 + rate, -duration));
      const assuranceMensuelle = amount * insuranceRate / 12;
      let capitalRestant = amount;
      let html = '<table><tr><th>Mois</th><th>Mensualité (€)</th><th>Assurance (€)</th><th>Total à payer (€)</th><th>Intérêts (€)</th><th>Capital remboursé (€)</th><th>Capital restant (€)</th></tr>';
      for(let i=1; i<=duration; i++) {
        const interet = capitalRestant * rate;
        const capital = annuite - interet;
        capitalRestant -= capital;
        html += `<tr>
          <td>${i}</td>
          <td>${annuite.toFixed(2)}</td>
          <td>${assuranceMensuelle.toFixed(2)}</td>
          <td>${(annuite + assuranceMensuelle).toFixed(2)}</td>
          <td>${interet.toFixed(2)}</td>
          <td>${capital.toFixed(2)}</td>
          <td>${capitalRestant > 0 ? capitalRestant.toFixed(2) : '0.00'}</td>
        </tr>`;
      }
      html += '</table>';
      document.getElementById('result').innerHTML = html;
    });
  </script>
</body>
<footer>
  <p>Etablissement financier - Simulation d'amortissement</p>
</footer>
</html>