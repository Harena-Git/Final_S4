<!DOCTYPE html>
<html lang="fr">

<head>
  <meta charset="UTF-8">
  <title>Gestion des fonds</title>
  <link rel="stylesheet" href="theme.css">
</head>

<body class="fixed-header">
  <header>
    <nav>
      <ul>
        <li><a href="index.html">Accueil</a></li>
        <li><a href="fonds.html">Gestion des fonds</a></li>
        <li><a href="loan_types.html">Gestion des types de prêt</a></li>
        <li><a href="client_loans.html">Gestion des prêts clients</a></li>
      </ul>
    </nav>
  </header>

  <h1>Ajout de fond</h1>
  <form id="ajout-fond-form">
    <label for="description">Description :</label>
    <input type="text" id="description" name="description" placeholder="Entrez une description" maxlength="50">
    <label for="valeur">Montant du fond :</label>
    <input type="number" id="valeur" name="valeur" placeholder="Entrez le montant" step="0.01" required>
    <button type="submit">Ajouter Fond</button>
  </form>
  <div id="liste-fonds"></div>

  <script>
    function chargerFonds() {
      fetch('/ws/fonds')
        .then(response => {
          if (!response.ok) throw new Error(`Erreur réseau: ${response.status}`);
          return response.text().then(text => JSON.parse(text));
        })
        .then(data => {
          const liste = document.getElementById('liste-fonds');
          liste.innerHTML = '<h2>Liste des fonds</h2>';
          if (data.length === 0) {
            liste.innerHTML += '<p>Aucun fond trouvé.</p>';
            return;
          }
          let table = '<table><thead><tr><th>ID</th><th>Description</th><th>Montant (€)</th><th>Date d\'ajout</th></tr></thead><tbody>';
          data.forEach(fond => {
            table += `<tr><td>${fond.id}</td><td>${fond.description || 'Aucune'}</td><td>${fond.valeur}</td><td>${fond.date_ajout}</td></tr>`;
          });
          table += '</tbody></table>';
          liste.innerHTML += table;
        })
        .catch(error => console.error('Erreur lors du chargement des fonds:', error));
    }

    document.getElementById('ajout-fond-form').addEventListener('submit', function (e) {
      e.preventDefault();
      const description = document.getElementById('description').value;
      const valeur = document.getElementById('valeur').value;

      fetch('/ws/fonds', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ description: description, valeur: valeur })
      })
        .then(response => {
          if (!response.ok) throw new Error(`Erreur réseau: ${response.status}`);
          return response.text().then(text => JSON.parse(text));
        })
        .then(data => {
          alert(data.message || 'Fond ajouté avec succès');
          document.getElementById('description').value = '';
          document.getElementById('valeur').value = '';
          chargerFonds();
        })
        .catch(error => console.error('Erreur lors de l\'ajout du fond:', error));
    });

    window.onload = function () {
      chargerFonds();
    };
  </script>

  <button onclick="window.location.href='index.html'">Retour à l'accueil</button>
  <br><br><br><br>
</body>
<footer>
  <p>Etablissement financier et prêt bancaire - Gestion des fonds</p>
</footer>
</html>
